on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
jobs:
  build-push:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Apply Environment Variables
        run: |
          echo "GITHUB_APP_ID=${{ secrets.ENV_GITHUB_APP_ID }}" >> ./assets/build.env
          echo 'GITHUB_APP_PRIVATE_KEY="${{ secrets.ENV_GITHUB_APP_PRIVATE_KEY }}"' >> ./assets/build.env
          echo 'SAKURA_API_TOKEN="${{ secrets.SAKURA_API_KEY }}"' >> ./assets/build.env
          echo 'SAKURA_API_SECRET="${{ secrets.SAKURA_API_SECRET }}"' >> ./assets/build.env
          echo 'SAKURACR_REGISTRY="${{ secrets.SAKURACR_CUSTOMERS_REGISTRY }}"' >> ./assets/build.env
          echo 'SAKURACR_USER="${{ secrets.SAKURACR_USER }}"' >> ./assets/build.env
          echo 'SAKURACR_PASSWORD="${{ secrets.SAKURACR_PASSWORD }}"' >> ./assets/build.env
      - name: Deploy to Sakura AppRun
        uses: meso/sakura-apprun-action@v3
        with:
          sakura-api-key: ${{ secrets.SAKURA_API_KEY }}
          sakura-api-secret: ${{ secrets.SAKURA_API_SECRET }}
          container-registry: ${{ vars.SAKURACR_REGISTRY }}
          container-registry-user: ${{ secrets.SAKURACR_USER }}
          container-registry-password: ${{ secrets.SAKURACR_PASSWORD }}
